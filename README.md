# vagrant-centos-bridge

## /etc/sysconfig/network-scripts/ifcfg-eth0
```
# Generated by dracut initrd
NAME="eth0"
ONBOOT=yes
NETBOOT=yes
UUID="6a9c8b91-41a6-460e-b849-0badf79c6f98"
IPV6INIT=yes
BOOTPROTO=dhcp
TYPE=Ethernet
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
PEERDNS=yes
PEERROUTES=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
#VAGRANT-BEGIN
# The contents below are automatically generated by Vagrant. Do not modify.
NM_CONTROLLED=no
BOOTPROTO=none
ONBOOT=yes
IPADDR=192.168.33.10
NETMASK=255.255.255.0
DEVICE=eth0
PEERDNS=no
#VAGRANT-END
```

## journalctl -u NetworkManager
```
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: <info>  updating /etc/sysconfig/network-scripts/ifcfg-eth0
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: <info>  (eth0): device state change: activated -> deactivating (reason 'connection-removed') [100 110 38]
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: <info>  (eth0): device state change: deactivating -> unmanaged (reason 'unmanaged') [110 10 3]
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: <info>  (eth0): deactivating device (reason 'unmanaged') [3]
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: <info>  (eth0): canceled DHCP transaction, DHCP client pid 619
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: <info>  (eth0): DHCPv4 state changed bound -> done
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: <error> [1444829571.809513] [platform/nm-linux-platform.c:2352] link_change(): Netlink error changing link 2:  <DOWN> mtu 0 (1) driver 'e1000' udi '/sys/devices/pci0000:00/0000:00:03.0/net/eth0': Address family not supported
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: <warn>  (eth0): failed to disable userspace IPv6LL address handling
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: <info>  parsing /etc/sysconfig/network-scripts/ifcfg-lo ...
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: <info>  (eth0): link disconnected
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: (NetworkManager:573): GLib-CRITICAL **: g_variant_is_object_path: assertion 'string != NULL' failed
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: ** (NetworkManager:573): CRITICAL **: marshal_object_path: assertion 'g_variant_is_object_path (path)' failed
10月 14 09:32:51 localhost.localdomain NetworkManager[573]: ** (NetworkManager:573): CRITICAL **: Could not marshal argument 2 for Action: type GHashTable_gchararray+GValue_, value ((GHashTable_gchararray+GValue_*) 0x7fc0984a08c0)
```

## vagrant/configure_networks.rb

Vagrantのネットワーク自動設定に関するコード

https://github.com/mitchellh/vagrant/blob/v1.7.4/plugins/guests/fedora/cap/configure_networks.rb

各変数に設定されている内容を確認した。

### 初回起動時

自動設定するインタフェースはeth1

```
networks: [{:type=>:static, :adapter_ip=>"192.168.33.1", :ip=>"192.168.33.10", :netmask=>"255.255.255.0", :auto_config=>true, :interface=>1}]
interface_names: ["eth0", "eth1"]
interface_names_by_slot: ["eth1"]
mac_addresses: ["52:54:00:d3:eb:a4", "08:00:27:89:d5:94"]
```

### 2回目起動時

自動設定するインタフェースがeth0に変わっている。

```
networks: [{:type=>:static, :adapter_ip=>"192.168.33.1", :ip=>"192.168.33.10", :netmask=>"255.255.255.0", :auto_config=>true, :interface=>1}]
interface_names: ["br0", "eth0", "eth1"]
interface_names_by_slot: ["eth0"]
mac_addresses: ["aa:08:d8:3b:bd:41", "52:54:00:d3:eb:a4", "08:00:27:89:d5:94"]
```
